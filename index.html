<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube ì°¸ì—¬ìœ¨ ë¶„ì„ê¸°</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #0073e6; color: white; }
    button { margin: 5px; padding: 10px 15px; border: none; background: #0073e6; color: white; border-radius: 5px; cursor: pointer; }
    button:hover { background: #005bb5; }
  </style>
</head>
<body>

  <h2>ğŸ“Š YouTube ì°¸ì—¬ìœ¨ ë¶„ì„ê¸°</h2>

  <label>í‚¤ì›Œë“œ (ì¤„ë°”ê¿ˆ êµ¬ë¶„):</label><br />
  <textarea id="keywords" rows="4" cols="50">ê±´ê°•ì •ë³´
íŠ¸ëŸ¼í”„ ê´€ì„¸</textarea><br><br>

  <label>ê¸°ê°„(ì¼):</label>
  <input type="number" id="days" value="7" style="width:80px" /><br><br>

  <button onclick="analyze()">ë¶„ì„ ì‹¤í–‰</button>
  <button onclick="showAll()">ì „ì²´ ë³´ê¸°</button>
  <button onclick="showTop10()">ì°¸ì—¬ìœ¨ ìƒìœ„ 10%ë§Œ ë³´ê¸°</button>

  <table id="resultTable">
    <thead>
      <tr>
        <th>ì¸ë„¤ì¼</th>
        <th>í‚¤ì›Œë“œ</th>
        <th>ì œëª©</th>
        <th>ì±„ë„ëª… (êµ¬ë…ì ìˆ˜)</th>
        <th>ì¡°íšŒìˆ˜</th>
        <th>ì¢‹ì•„ìš”</th>
        <th>ëŒ“ê¸€</th>
        <th>ì°¸ì—¬ìœ¨%</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // âœ… ì—¬ê¸° API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ê³ ì •)
    const apiKey = "AIzaSyXXXXXXX_ëŒ€í‘œë‹˜_API_í‚¤_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°";

    async function analyze() {
      const keywords = document.getElementById("keywords").value.trim().split("\n");
      const days = parseInt(document.getElementById("days").value);
      const tbody = document.querySelector("#resultTable tbody");
      tbody.innerHTML = "";

      for (const keyword of keywords) {
        const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=10&q=${encodeURIComponent(keyword)}&key=${apiKey}`;
        const searchRes = await fetch(searchUrl);
        const searchData = await searchRes.json();

        for (const item of searchData.items || []) {
          const videoId = item.id.videoId;
          const title = item.snippet.title;
          const thumbnail = item.snippet.thumbnails.default.url;
          const channel = item.snippet.channelTitle;

          const statsUrl = `https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet&id=${videoId}&key=${apiKey}`;
          const statsRes = await fetch(statsUrl);
          const statsData = await statsRes.json();

          if (statsData.items.length > 0) {
            const stats = statsData.items[0].statistics;
            const views = parseInt(stats.viewCount || 0);
            const likes = parseInt(stats.likeCount || 0);
            const comments = parseInt(stats.commentCount || 0);
            const engagement = ((likes + comments) / views * 100).toFixed(2);

            const row = `<tr>
              <td><img src="${thumbnail}" width="100"></td>
              <td>${keyword}</td>
              <td>${title}</td>
              <td>${channel}</td>
              <td>${views.toLocaleString()}</td>
              <td>${likes.toLocaleString()}</td>
              <td>${comments.toLocaleString()}</td>
              <td>${engagement}%</td>
            </tr>`;
            tbody.insertAdjacentHTML("beforeend", row);
          }
        }
      }
    }

    function showAll() {
      const rows = document.querySelectorAll("#resultTable tbody tr");
      rows.forEach(row => row.style.display = "");
    }

    function showTop10() {
      const rows = Array.from(document.querySelectorAll("#resultTable tbody tr"));
      const sorted = rows.sort((a, b) => parseFloat(b.cells[7].innerText) - parseFloat(a.cells[7].innerText));
      const top10 = sorted.slice(0, Math.ceil(rows.length * 0.1));
      rows.forEach(row => row.style.display = "none");
      top10.forEach(row => row.style.display = "");
    }
  </script>
</body>
</html>
