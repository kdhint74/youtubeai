<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>YouTube ì°¸ì—¬ìœ¨ ë¶„ì„ê¸°</title>
<style>
  body { font-family: "ë§‘ì€ ê³ ë”•", sans-serif; background-color: #f7f7f7; padding: 30px; }
  h1 { color: #222; margin-bottom: 10px; }
  textarea, input { width: 100%; max-width: 400px; padding: 8px; margin-bottom: 10px; }
  button { background-color: #007bff; color: white; border: none; padding: 8px 14px; cursor: pointer; border-radius: 5px; }
  button:hover { background-color: #0056b3; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; background: white; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #007bff; color: white; }
  img { width: 120px; height: auto; border-radius: 4px; }
</style>
</head>
<body>

<h1>ğŸ“Š YouTube ì°¸ì—¬ìœ¨ ë¶„ì„ê¸°</h1>

<label>í‚¤ì›Œë“œ (ì¤„ë°”ê¿ˆ êµ¬ë¶„):</label><br />
<textarea id="keywords" rows="3" placeholder="ì˜ˆ: ê±´ê°•ì •ë³´&#10;íŠ¸ëŸ¼í”„ ê´€ì„¸"></textarea><br />

<label>ê¸°ê°„(ì¼):</label><br />
<input type="number" id="days" value="7" /><br />

<button onclick="analyze()">ë¶„ì„ ì‹¤í–‰</button>
<button onclick="showAll()">ì „ì²´ ë³´ê¸°</button>
<button onclick="showTop10()">ì°¸ì—¬ìœ¨ ìƒìœ„ 10%ë§Œ ë³´ê¸°</button>

<table id="resultTable">
  <thead>
    <tr>
      <th>ì¸ë„¤ì¼</th>
      <th>í‚¤ì›Œë“œ</th>
      <th>ì œëª©</th>
      <th>ì±„ë„ëª… (êµ¬ë…ì ìˆ˜)</th>
      <th>ì¡°íšŒìˆ˜</th>
      <th>ì¢‹ì•„ìš”</th>
      <th>ëŒ“ê¸€</th>
      <th>ì°¸ì—¬ìœ¨%</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
// âœ… YouTube API í‚¤ ê³ ì • (ëŒ€í‘œë‹˜ í‚¤ë¡œ êµì²´)
const API_KEY = "ì—¬ê¸°ì—_ëŒ€í‘œë‹˜_API_KEY_ë¶™ì—¬ë„£ê¸°";

// ê²°ê³¼ ì „ì—­ ë³€ìˆ˜
let allResults = [];

// ë¶„ì„ ì‹¤í–‰
async function analyze() {
  const keywords = document.getElementById("keywords").value.trim().split("\n");
  const days = parseInt(document.getElementById("days").value.trim()) || 7;
  const tableBody = document.querySelector("#resultTable tbody");
  tableBody.innerHTML = "";

  for (const keyword of keywords) {
    const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=10&q=${encodeURIComponent(keyword)}&key=${API_KEY}`;
    const searchRes = await fetch(searchUrl);
    const searchData = await searchRes.json();

    if (!searchData.items) continue;

    for (const item of searchData.items) {
      const videoId = item.id.videoId;
      const statsUrl = `https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet&id=${videoId}&key=${API_KEY}`;
      const statsRes = await fetch(statsUrl);
      const statsData = await statsRes.json();

      if (!statsData.items?.length) continue;

      const vid = statsData.items[0];
      const title = vid.snippet.title;
      const channel = vid.snippet.channelTitle;
      const views = parseInt(vid.statistics.viewCount || 0);
      const likes = parseInt(vid.statistics.likeCount || 0);
      const comments = parseInt(vid.statistics.commentCount || 0);
      const participation = views > 0 ? (((likes + comments) / views) * 100).toFixed(2) : 0;

      allResults.push({ keyword, title, channel, views, likes, comments, participation, thumb: item.snippet.thumbnails.medium.url });
    }
  }

  renderTable(allResults);
}

function renderTable(data) {
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";
  for (const row of data) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><img src="${row.thumb}" /></td>
      <td>${row.keyword}</td>
      <td>${row.title}</td>
      <td>${row.channel}</td>
      <td>${row.views.toLocaleString()}</td>
      <td>${row.likes.toLocaleString()}</td>
      <td>${row.comments.toLocaleString()}</td>
      <td>${row.participation}%</td>`;
    tbody.appendChild(tr);
  }
}

function showAll() {
  renderTable(allResults);
}

function showTop10() {
  const sorted = [...allResults].sort((a,b)=>b.participation - a.participation);
  const top = sorted.slice(0, Math.ceil(allResults.length * 0.1));
  renderTable(top);
}
</script>

</body>
</html>
